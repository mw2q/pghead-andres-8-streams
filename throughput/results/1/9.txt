BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%sandy%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 271808811.944077
 ALGERIA                   |   1997 | 452574230.925971
 ALGERIA                   |   1996 |  456476765.80405
 ALGERIA                   |   1995 | 464886414.365825
 ALGERIA                   |   1994 | 451311596.052408
 ALGERIA                   |   1993 | 461316173.370708
 ALGERIA                   |   1992 | 460181124.300678
 ARGENTINA                 |   1998 | 270783932.732385
 ARGENTINA                 |   1997 | 466162429.089887
 ARGENTINA                 |   1996 | 463668958.198574
 ARGENTINA                 |   1995 | 461547182.402917
 ARGENTINA                 |   1994 |  468202080.31737
 ARGENTINA                 |   1993 | 464464348.139945
 ARGENTINA                 |   1992 |  465168149.34557
 BRAZIL                    |   1998 | 275019872.009691
 BRAZIL                    |   1997 | 473257547.317682
 BRAZIL                    |   1996 | 462392825.881574
 BRAZIL                    |   1995 | 464348342.526866
 BRAZIL                    |   1994 | 468278801.892837
 BRAZIL                    |   1993 | 468016849.250449
 BRAZIL                    |   1992 | 471071218.895054
 CANADA                    |   1998 | 277980174.990563
 CANADA                    |   1997 | 482727505.142646
 CANADA                    |   1996 | 479090200.527654
 CANADA                    |   1995 | 486489633.601427
 CANADA                    |   1994 | 489862609.258564
 CANADA                    |   1993 | 479749364.617839
 CANADA                    |   1992 | 480081270.490124
 CHINA                     |   1998 | 274933092.763115
 CHINA                     |   1997 | 462928885.077337
 CHINA                     |   1996 | 461152288.557687
 CHINA                     |   1995 |  468434697.07004
 CHINA                     |   1994 | 466054947.216527
 CHINA                     |   1993 |  465125412.17098
 CHINA                     |   1992 | 466078731.800367
 EGYPT                     |   1998 | 269769589.853595
 EGYPT                     |   1997 | 461872869.090316
 EGYPT                     |   1996 | 464938889.243313
 EGYPT                     |   1995 | 471495597.679223
 EGYPT                     |   1994 |   462928394.4017
 EGYPT                     |   1993 | 469362791.251712
 EGYPT                     |   1992 | 471107563.908811
 ETHIOPIA                  |   1998 |  266276582.96782
 ETHIOPIA                  |   1997 | 457049269.587821
 ETHIOPIA                  |   1996 | 455628486.302355
 ETHIOPIA                  |   1995 | 456709707.514325
 ETHIOPIA                  |   1994 | 457656088.694219
 ETHIOPIA                  |   1993 | 456224782.929474
 ETHIOPIA                  |   1992 | 470749118.577377
 FRANCE                    |   1998 | 275447433.390776
 FRANCE                    |   1997 | 465727140.512312
 FRANCE                    |   1996 | 465898153.095803
 FRANCE                    |   1995 | 473690307.324833
 FRANCE                    |   1994 | 462840200.157314
 FRANCE                    |   1993 | 460783537.546967
 FRANCE                    |   1992 | 460426232.456093
 GERMANY                   |   1998 | 274578458.148958
 GERMANY                   |   1997 | 480484312.113629
 GERMANY                   |   1996 | 478145419.847291
 GERMANY                   |   1995 | 472406777.463817
 GERMANY                   |   1994 | 471426714.743143
 GERMANY                   |   1993 |  479679001.10143
 GERMANY                   |   1992 | 475211224.648499
 INDIA                     |   1998 | 284716237.258614
 INDIA                     |   1997 | 479217611.922801
 INDIA                     |   1996 | 472708981.397074
 INDIA                     |   1995 | 474560603.049427
 INDIA                     |   1994 | 479797631.788135
 INDIA                     |   1993 | 477182963.247796
 INDIA                     |   1992 | 474784868.054531
 INDONESIA                 |   1998 | 267751155.692409
 INDONESIA                 |   1997 | 455315386.807887
 INDONESIA                 |   1996 | 459001613.230649
 INDONESIA                 |   1995 | 449723027.503789
 INDONESIA                 |   1994 | 458754912.717397
 INDONESIA                 |   1993 | 450568816.639091
 INDONESIA                 |   1992 | 452968779.469023
 IRAN                      |   1998 | 271017489.092881
 IRAN                      |   1997 |  468279489.80389
 IRAN                      |   1996 | 471599353.696197
 IRAN                      |   1995 | 464009036.206896
 IRAN                      |   1994 | 472670541.496954
 IRAN                      |   1993 | 466616538.720303
 IRAN                      |   1992 | 466998841.166612
 IRAQ                      |   1998 |  275510836.32961
 IRAQ                      |   1997 | 472310957.298443
 IRAQ                      |   1996 | 472469003.402657
 IRAQ                      |   1995 | 479350658.371623
 IRAQ                      |   1994 | 472618846.849666
 IRAQ                      |   1993 | 471340957.703046
 IRAQ                      |   1992 | 474479184.137995
 JAPAN                     |   1998 | 271698781.359368
 JAPAN                     |   1997 | 464094705.944838
 JAPAN                     |   1996 | 464412494.112226
 JAPAN                     |   1995 | 469145574.039277
 JAPAN                     |   1994 | 465387432.815955
 JAPAN                     |   1993 | 463792909.990783
 JAPAN                     |   1992 | 469683483.613004
 JORDAN                    |   1998 |  264347596.29947
 JORDAN                    |   1997 | 452876779.726542
 JORDAN                    |   1996 | 455973783.779795
 JORDAN                    |   1995 | 453409643.961731
 JORDAN                    |   1994 | 459269704.353251
 JORDAN                    |   1993 | 464996022.914077
 JORDAN                    |   1992 | 460298293.747971
 KENYA                     |   1998 | 273179384.610517
 KENYA                     |   1997 | 468444933.982383
 KENYA                     |   1996 | 469487833.747369
 KENYA                     |   1995 |  468644688.44563
 KENYA                     |   1994 | 470704563.572302
 KENYA                     |   1993 | 467334985.119374
 KENYA                     |   1992 | 467695088.164248
 MOROCCO                   |   1998 | 277442517.384561
 MOROCCO                   |   1997 | 472925625.268687
 MOROCCO                   |   1996 | 469494615.244694
 MOROCCO                   |   1995 | 471909088.628539
 MOROCCO                   |   1994 | 473957050.421629
 MOROCCO                   |   1993 | 467911426.678122
 MOROCCO                   |   1992 | 461209409.189907
 MOZAMBIQUE                |   1998 | 272420177.402188
 MOZAMBIQUE                |   1997 |  452112278.63835
 MOZAMBIQUE                |   1996 | 451958920.836533
 MOZAMBIQUE                |   1995 | 454114744.207952
 MOZAMBIQUE                |   1994 | 458720046.384329
 MOZAMBIQUE                |   1993 | 450349741.374014
 MOZAMBIQUE                |   1992 | 452412679.364489
 PERU                      |   1998 | 266227841.457125
 PERU                      |   1997 | 454774016.289991
 PERU                      |   1996 | 461555603.595415
 PERU                      |   1995 | 462640683.938653
 PERU                      |   1994 | 470450851.793071
 PERU                      |   1993 | 457509750.099116
 PERU                      |   1992 | 466630607.364332
 ROMANIA                   |   1998 | 271685711.913053
 ROMANIA                   |   1997 | 460225228.850628
 ROMANIA                   |   1996 | 461572016.545088
 ROMANIA                   |   1995 | 462255496.457797
 ROMANIA                   |   1994 | 458084845.952556
 ROMANIA                   |   1993 | 455582986.947273
 ROMANIA                   |   1992 | 471187582.615262
 RUSSIA                    |   1998 | 270692539.066927
 RUSSIA                    |   1997 | 467806162.258347
 RUSSIA                    |   1996 | 488734373.472132
 RUSSIA                    |   1995 | 474166390.301573
 RUSSIA                    |   1994 |  478293343.20341
 RUSSIA                    |   1993 | 473871965.348339
 RUSSIA                    |   1992 | 478715357.275089
 SAUDI ARABIA              |   1998 | 274461409.557483
 SAUDI ARABIA              |   1997 | 471285117.437501
 SAUDI ARABIA              |   1996 | 469061216.104064
 SAUDI ARABIA              |   1995 | 468201806.364134
 SAUDI ARABIA              |   1994 | 464286517.849391
 SAUDI ARABIA              |   1993 |  467610079.24503
 SAUDI ARABIA              |   1992 | 471733198.761647
 UNITED KINGDOM            |   1998 | 274550697.015245
 UNITED KINGDOM            |   1997 |   470902262.9271
 UNITED KINGDOM            |   1996 | 473280912.766183
 UNITED KINGDOM            |   1995 | 463859723.777332
 UNITED KINGDOM            |   1994 | 470350596.526406
 UNITED KINGDOM            |   1993 | 468495490.028084
 UNITED KINGDOM            |   1992 | 470645920.006934
 UNITED STATES             |   1998 | 276593048.328824
 UNITED STATES             |   1997 | 472671640.115213
 UNITED STATES             |   1996 | 478636326.061562
 UNITED STATES             |   1995 | 472947022.201616
 UNITED STATES             |   1994 | 477091584.399586
 UNITED STATES             |   1993 | 479622696.110432
 UNITED STATES             |   1992 | 471819682.750108
 VIETNAM                   |   1998 | 269906905.920211
 VIETNAM                   |   1997 | 454799687.853339
 VIETNAM                   |   1996 | 464803748.886432
 VIETNAM                   |   1995 | 458003834.347384
 VIETNAM                   |   1994 | 456833882.635859
 VIETNAM                   |   1993 | 462079411.620807
 VIETNAM                   |   1992 | 458742480.211578
(175 rows)

COMMIT;
COMMIT
