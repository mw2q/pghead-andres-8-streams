BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%peru%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 267542085.909809
 ALGERIA                   |   1997 | 455240372.616191
 ALGERIA                   |   1996 | 458334545.093636
 ALGERIA                   |   1995 | 458881292.705106
 ALGERIA                   |   1994 | 461620697.338376
 ALGERIA                   |   1993 | 454690742.590529
 ALGERIA                   |   1992 | 457470297.500555
 ARGENTINA                 |   1998 | 275736616.483893
 ARGENTINA                 |   1997 | 469176084.735681
 ARGENTINA                 |   1996 | 478469677.415931
 ARGENTINA                 |   1995 |  473750175.89305
 ARGENTINA                 |   1994 | 473519533.959815
 ARGENTINA                 |   1993 | 463528224.654118
 ARGENTINA                 |   1992 | 470966195.248445
 BRAZIL                    |   1998 | 275759019.343965
 BRAZIL                    |   1997 | 475685211.131812
 BRAZIL                    |   1996 | 476476994.862751
 BRAZIL                    |   1995 |  476899284.59919
 BRAZIL                    |   1994 | 475015269.421513
 BRAZIL                    |   1993 | 470332078.781044
 BRAZIL                    |   1992 | 470567959.121033
 CANADA                    |   1998 | 273953331.444786
 CANADA                    |   1997 | 480636030.112271
 CANADA                    |   1996 | 481188188.072221
 CANADA                    |   1995 | 474193305.558453
 CANADA                    |   1994 | 478266012.833068
 CANADA                    |   1993 |  473108521.93408
 CANADA                    |   1992 | 487690137.205897
 CHINA                     |   1998 | 276470123.918276
 CHINA                     |   1997 |  468443968.30665
 CHINA                     |   1996 |   470580347.5542
 CHINA                     |   1995 | 469892581.888232
 CHINA                     |   1994 | 472550539.333017
 CHINA                     |   1993 | 466587824.727139
 CHINA                     |   1992 | 471303545.387726
 EGYPT                     |   1998 |   274943699.8258
 EGYPT                     |   1997 | 469529110.818364
 EGYPT                     |   1996 | 472040782.247511
 EGYPT                     |   1995 | 471083370.139718
 EGYPT                     |   1994 | 467478149.023109
 EGYPT                     |   1993 | 465843858.152141
 EGYPT                     |   1992 |  471022188.39841
 ETHIOPIA                  |   1998 | 263413208.024949
 ETHIOPIA                  |   1997 | 453735622.915097
 ETHIOPIA                  |   1996 | 457380528.270642
 ETHIOPIA                  |   1995 | 451926019.328138
 ETHIOPIA                  |   1994 | 462929656.646136
 ETHIOPIA                  |   1993 | 458240202.228006
 ETHIOPIA                  |   1992 | 459992394.633865
 FRANCE                    |   1998 | 268617301.054287
 FRANCE                    |   1997 | 462773555.797119
 FRANCE                    |   1996 | 468745318.735037
 FRANCE                    |   1995 | 462828876.911588
 FRANCE                    |   1994 | 467943367.081105
 FRANCE                    |   1993 | 471261187.179267
 FRANCE                    |   1992 | 472834839.141169
 GERMANY                   |   1998 | 277660493.517528
 GERMANY                   |   1997 | 472885554.859339
 GERMANY                   |   1996 | 471884779.291626
 GERMANY                   |   1995 | 474905374.959173
 GERMANY                   |   1994 |  486069387.04969
 GERMANY                   |   1993 | 475075343.025773
 GERMANY                   |   1992 | 471371511.025402
 INDIA                     |   1998 |  278751489.49588
 INDIA                     |   1997 | 473293540.776791
 INDIA                     |   1996 | 486628316.399031
 INDIA                     |   1995 | 475462909.448465
 INDIA                     |   1994 | 473988881.982183
 INDIA                     |   1993 | 479060770.815033
 INDIA                     |   1992 | 481184388.153159
 INDONESIA                 |   1998 | 273268871.826227
 INDONESIA                 |   1997 |  461580601.83483
 INDONESIA                 |   1996 | 458269593.670546
 INDONESIA                 |   1995 | 465941173.897822
 INDONESIA                 |   1994 | 468333109.097703
 INDONESIA                 |   1993 |  460841895.17029
 INDONESIA                 |   1992 | 468281809.620691
 IRAN                      |   1998 | 273275789.041307
 IRAN                      |   1997 | 462509084.077321
 IRAN                      |   1996 | 459023556.135786
 IRAN                      |   1995 | 456272515.828985
 IRAN                      |   1994 | 456737999.147871
 IRAN                      |   1993 | 462249110.179472
 IRAN                      |   1992 | 467214139.028424
 IRAQ                      |   1998 |  278196367.63638
 IRAQ                      |   1997 | 480126980.854113
 IRAQ                      |   1996 | 485929305.590688
 IRAQ                      |   1995 | 477262178.345165
 IRAQ                      |   1994 | 480697319.137859
 IRAQ                      |   1993 | 474871307.123658
 IRAQ                      |   1992 | 467847534.974648
 JAPAN                     |   1998 |  276701264.18733
 JAPAN                     |   1997 | 462684462.770741
 JAPAN                     |   1996 | 472106190.880722
 JAPAN                     |   1995 | 460579235.433645
 JAPAN                     |   1994 | 469017200.269408
 JAPAN                     |   1993 | 467931621.956123
 JAPAN                     |   1992 | 465894886.208041
 JORDAN                    |   1998 | 268160126.225353
 JORDAN                    |   1997 | 450100937.840651
 JORDAN                    |   1996 | 455252643.301838
 JORDAN                    |   1995 | 459977062.697585
 JORDAN                    |   1994 | 456879629.953858
 JORDAN                    |   1993 | 461029230.293375
 JORDAN                    |   1992 | 450294899.173514
 KENYA                     |   1998 | 280201668.692282
 KENYA                     |   1997 | 472348480.012495
 KENYA                     |   1996 | 478234600.514238
 KENYA                     |   1995 |  473651101.76443
 KENYA                     |   1994 | 466215982.135018
 KENYA                     |   1993 | 477592128.554814
 KENYA                     |   1992 | 471752059.316845
 MOROCCO                   |   1998 | 277109656.366766
 MOROCCO                   |   1997 | 471991767.648197
 MOROCCO                   |   1996 | 480476830.485091
 MOROCCO                   |   1995 | 471854904.556259
 MOROCCO                   |   1994 | 478340259.462115
 MOROCCO                   |   1993 | 471179919.449731
 MOROCCO                   |   1992 | 471374382.285192
 MOZAMBIQUE                |   1998 | 271067881.764482
 MOZAMBIQUE                |   1997 | 457752175.738949
 MOZAMBIQUE                |   1996 | 466750284.189691
 MOZAMBIQUE                |   1995 | 457769780.482423
 MOZAMBIQUE                |   1994 |  462423673.43928
 MOZAMBIQUE                |   1993 | 462509262.073417
 MOZAMBIQUE                |   1992 | 461578454.370693
 PERU                      |   1998 | 280141246.913291
 PERU                      |   1997 | 466510814.144737
 PERU                      |   1996 | 480343078.887461
 PERU                      |   1995 | 476300807.961238
 PERU                      |   1994 |  470928185.54699
 PERU                      |   1993 | 474824068.404534
 PERU                      |   1992 |  467735743.41266
 ROMANIA                   |   1998 | 275672153.143744
 ROMANIA                   |   1997 | 468774163.825228
 ROMANIA                   |   1996 | 469014445.605423
 ROMANIA                   |   1995 | 472176611.543287
 ROMANIA                   |   1994 | 463906135.229341
 ROMANIA                   |   1993 |  463798577.31301
 ROMANIA                   |   1992 | 464461176.190826
 RUSSIA                    |   1998 | 280110941.456799
 RUSSIA                    |   1997 | 470325068.627501
 RUSSIA                    |   1996 | 473459101.036411
 RUSSIA                    |   1995 | 475686828.907829
 RUSSIA                    |   1994 | 473547885.869293
 RUSSIA                    |   1993 |  470271833.22598
 RUSSIA                    |   1992 | 481750050.572469
 SAUDI ARABIA              |   1998 |  272509872.97307
 SAUDI ARABIA              |   1997 | 470960149.184486
 SAUDI ARABIA              |   1996 | 473312525.156661
 SAUDI ARABIA              |   1995 | 467352594.091887
 SAUDI ARABIA              |   1994 |  460410746.71721
 SAUDI ARABIA              |   1993 | 463031091.243824
 SAUDI ARABIA              |   1992 | 471512339.494522
 UNITED KINGDOM            |   1998 | 272742017.048421
 UNITED KINGDOM            |   1997 |   463992476.1593
 UNITED KINGDOM            |   1996 |  469550023.64177
 UNITED KINGDOM            |   1995 | 467077383.757635
 UNITED KINGDOM            |   1994 | 462513918.519885
 UNITED KINGDOM            |   1993 | 472384568.565678
 UNITED KINGDOM            |   1992 | 469931948.211844
 UNITED STATES             |   1998 | 273342853.132836
 UNITED STATES             |   1997 |  467534476.47749
 UNITED STATES             |   1996 | 466696401.303691
 UNITED STATES             |   1995 | 469067943.413841
 UNITED STATES             |   1994 | 470467668.970887
 UNITED STATES             |   1993 | 465239796.279521
 UNITED STATES             |   1992 | 467817083.703321
 VIETNAM                   |   1998 | 275787396.938613
 VIETNAM                   |   1997 | 466309243.384161
 VIETNAM                   |   1996 | 462497520.022563
 VIETNAM                   |   1995 | 464772789.055843
 VIETNAM                   |   1994 | 467921818.849231
 VIETNAM                   |   1993 | 470301382.520225
 VIETNAM                   |   1992 | 460540043.328926
(175 rows)

COMMIT;
COMMIT
